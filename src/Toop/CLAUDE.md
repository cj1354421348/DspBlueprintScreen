# 模块: Toop (通用工具)

### 导航 (Navigation)
[返回根目录](../../CLAUDE.md)

---

## 模块概述 (Module Overview)

`Toop` (Tools) 模块是一个存放应用级通用工具和辅助类的集合。它提供了一系列静态类和函数，用于处理一些被多个模块共享的、具有特定职责的横切关注点，如性能优化、业务逻辑特例处理和UI反馈。

## 核心职责 (Core Responsibilities)

1.  **性能优化**: 通过 `MapPool` 提供一个内存缓存层，用于缓存预处理过的蓝图统计数据，避免重复的文件I/O，显著提升筛选性能。
2.  **特例逻辑封装**: `BuilToop` 类用于封装和处理游戏数据中的一些特殊情况，使主业务逻辑更纯粹、更易于理解。
3.  **UI反馈封装**: `Tips` 模块封装了 `Element Plus` 的消息提示组件，提供了风格统一、调用简洁的全局成功/错误提示函数。

## 关键文件索引 (Key File Index)

| 文件路径 | 主要职责 | 关键组件/函数 |
| :--- | :--- | :--- |
| `MapPool.ts` | 蓝图统计数据的内存缓存服务 | `MapPool` (static class), `_findFoOutPool()` |
| `BuilToop.ts`| 建筑相关的特例逻辑处理 | `BuilToop` (static class), `changeRecipeId()` |
| `Tips.ts` | 全局UI消息提示 | `Tipsessage()`, `TipError()` |

## 关键组件分析 (Key Component Analysis)

### `MapPool.ts`
这是应用性能优化的核心。它实现了一个**按需加载的缓存（Lazy-loading Cache）**模式。
- **工作机制**: 当业务逻辑（`HomeView`）请求某个蓝图的统计数据时，`MapPool` 首先检查内存中是否存在。如果存在（缓存命中），则直接返回；如果不存在（缓存未命中），它会异步地从文件系统中读取对应的 `.json` 文件，将其内容加载到内存缓存中，然后再返回。
- **架构角色**: 它作为 `MapData`（元数据索引）和 `HomeView`（UI逻辑）之间的一个中间层，专门负责 `newitemData` 对象的生命周期管理和性能优化。

### `BuilToop.ts`
一个典型的**策略模式**的简单应用。它将“如何处理分馏塔配方ID”这个特殊的业务规则从主流程（`buildingCounter`）中抽离出来，封装成一个独立的静态方法。这样做的好处是，如果未来发现更多类似的特例，只需在 `BuilToop` 中添加新的方法或逻辑即可，而无需修改核心的统计流程代码。

### `Tips.ts`
一个**外观模式（Facade Pattern）**的体现。它为 `Element Plus` 的 `ElMessage` 组件提供了一个更简单、更符合应用需求的接口。通过 `Tipsessage` 和 `TipError` 这两个函数，它隐藏了底层组件库的复杂配置，并强制了应用内消息提示风格的统一。

## AI 使用指引 (AI Usage Guide)

1.  **缓存管理**: 在进行性能分析时，应重点关注 `MapPool` 的行为。理解缓存何时命中、何时未命中，是诊断筛选性能问题的关键。
2.  **封装通用逻辑**: 当在多个模块中发现重复的代码片段或逻辑时（Don't Repeat Yourself），应考虑将其提取出来，作为新的静态方法添加到合适的工具类中（如果还没有，可以新建一个）。
3.  **UI反馈**: 在应用中任何需要向用户提供非阻塞式即时反馈的地方，都应调用 `Tips.ts` 中提供的函数，以保持UI体验的一致性。
